<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnosis & Prescription History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

<div class="container mt-5 p-4 shadow bg-light rounded">
    <h2 class="text-center mb-4">Diagnosis & Prescription History</h2>

    <div th:if="${historyList != null and !historyList.isEmpty()}">
        <div th:each="entry : ${historyList}" class="card mb-4">
            <div class="card-header bg-primary text-white">
                <strong>Date:</strong>
                <span th:text="${#temporals.format(entry.timestamp, 'dd MMM yyyy HH:mm')}"></span>
            </div>
            <div class="card-body">
                <!-- Diagnosis Section -->
                <h5><strong>Diagnosis:</strong></h5>
                <p th:if="${entry.prescription == null or entry.prescription.diagnosisAilmentDescription == null}">
                    No diagnosis available.
                </p>
                <p th:if="${entry.prescription != null and entry.prescription.diagnosisAilmentDescription != null}"
                   th:text="${entry.prescription.diagnosisAilmentDescription}"></p>

                <!-- Prescription Description -->
                <h5><strong>Prescription Notes:</strong></h5>
                <p th:if="${entry.prescription != null}" th:text="${entry.prescription.prescriptionDescription}">-</p>
                <p th:if="${entry.prescription == null}" class="text-muted">No prescription notes available.</p>

                <!-- Medicine List -->
                <h5><strong>Medicines:</strong></h5>
                <ul th:if="${entry.prescription != null and entry.prescription.medicineList != null}">
                    <li th:each="med : ${entry.prescription.medicineList}" th:text="${med}"></li>
                </ul>
                <p th:if="${entry.prescription == null or entry.prescription.medicineList == null}" class="text-muted">No medicines prescribed.</p>
            </div>
        </div>

        <!-- Pagination Controls -->
        <nav th:if="${totalPages > 1}" aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-4">
                <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/Diagnosis(page=${currentPage - 1}, size=${pageSize}, patientId=${patient.userId}, doctorId=${doctor.userId})}">
                        Previous
                    </a>
                </li>
                <li class="page-item"
                    th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link"
                       th:href="@{/Diagnosis(page=${i}, size=${pageSize}, patientId=${patient.userId}, doctorId=${doctor.userId})}"
                       th:text="${i + 1}">1</a>
                </li>
                <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/Diagnosis(page=${currentPage + 1}, size=${pageSize}, patientId=${patient.userId}, doctorId=${doctor.userId})}">
                        Next
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <p th:if="${historyList == null or historyList.isEmpty()}" class="text-muted text-center">
        No diagnosis or prescription history available.
    </p>

    <!-- Back to Dashboard -->
    <form th:action="@{/patient/backDashboard}" method="post" class="mt-4 text-center">
        <input type="hidden" name="patientId" th:value="${patient.userId}" />
        <input type="hidden" name="doctorId" th:value="${doctor.userId}" />
        <button class="btn btn-secondary">Back to Dashboard</button>
    </form>
</div>

</body>
</html>
